{% extends "base.html" %}
{% block title %}Detalle de Fecha{% endblock %}

{% block content %}

<h2 class="mb-3">
    üèÅ Pron√≥sticos ‚Äì {{ carrera.pais }} ({{ carrera.fecha }})
</h2>

<!-- RESULTADO OFICIAL -->
<div class="card mb-4">
    <div class="card-body">
        <h4 class="card-title">Resultado oficial</h4>

        <ul class="mb-2">
            <li><strong>Pole:</strong> {{ resultado.pole }}</li>

            {% if resultado.sprint_ganador %}
                <li><strong>Sprint:</strong> {{ resultado.sprint_ganador }}</li>
            {% endif %}

            <li><strong>P1:</strong> {{ resultado.p1 }}</li>
            <li><strong>P2:</strong> {{ resultado.p2 }}</li>
            <li><strong>P3:</strong> {{ resultado.p3 }}</li>
        </ul>

        <small class="text-muted">
            üü¢ Podio Exacto: 3 pts. &nbsp; | &nbsp;
            üü° Piloto en podio (posici√≥n incorrecta): 1 Pto.&nbsp; | &nbsp;
            üîµ Poleman: 2 pts &nbsp; | &nbsp;
            üü£ Sprint: 2 pts 
        </small>
    </div>
</div>

<!-- TABLA DE PRON√ìSTICOS -->
<div class="card">
    <div class="card-body">
        <h4 class="card-title mb-3">Resultados de los participantes</h4>

        <div class="table-responsive">
            <table class="table table-striped table-bordered align-middle">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Usuario</th>

                        <th class="d-none d-md-table-cell">Pole</th>

                        {% if resultado.sprint_ganador %}
                            <th class="d-none d-md-table-cell">Sprint</th>
                        {% endif %}

                        <th class="d-none d-md-table-cell">P1</th>
                        <th class="d-none d-md-table-cell">P2</th>
                        <th class="d-none d-md-table-cell">P3</th>

                        <th>Puntos</th>
                    </tr>
                </thead>

                <tbody>
                {% for p in pronosticos | sort(attribute='puntos', reverse=True) %}
                    <tr class="{% if loop.first %}table-info fw-bold{% endif %}">
                        <td>
                            {% if loop.first %}üèÜ{% else %}{{ loop.index }}{% endif %}
                        </td>

                        <td>{{ p.usuario }}</td>

                        <!-- POLE -->
                        <td class="d-none d-md-table-cell
                            {% if p.pole == resultado.pole %} bg-success-subtle fw-bold {% endif %}">
                            {{ p.pole }}
                        </td>

                        <!-- SPRINT -->
                        {% if resultado.sprint_ganador %}
                        <td class="d-none d-md-table-cell
                            {% if p.sprint_ganador == resultado.sprint_ganador %} bg-success-subtle fw-bold {% endif %}">
                            {{ p.sprint_ganador }}
                        </td>
                        {% endif %}

                        <!-- P1 -->
                        <td class="d-none d-md-table-cell
                            {% if p.p1 == resultado.p1 %}
                                bg-exacto
                            {% elif p.p1 in [resultado.p1, resultado.p2, resultado.p3] %}
                                bg-parcial
                            {% endif %}
                        ">
                            {{ p.p1 }}
                        </td>

                        <!-- P2 -->
                        <td class="d-none d-md-table-cell
                            {% if p.p2 == resultado.p2 %}
                                bg-success-subtle fw-bold
                            {% elif p.p2 in [resultado.p1, resultado.p2, resultado.p3] %}
                                bg-warning-subtle
                            {% endif %}
                        ">
                            {{ p.p2 }}
                        </td>

                        <!-- P3 -->
                        <td class="d-none d-md-table-cell
                            {% if p.p3 == resultado.p3 %}
                                bg-success-subtle fw-bold
                            {% elif p.p3 in [resultado.p1, resultado.p2, resultado.p3] %}
                                bg-warning-subtle
                            {% endif %}
                        ">
                            {{ p.p3 }}
                        </td>

                        <td>
                            <strong>{{ p.puntos }}</strong>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
<!-- ================= RANKING ================= -->
<div class="d-grid gap-2 mt-4">
    <a href="/ranking" class="btn btn-outline-dark">
        üèÜ Ver Ranking General
    </a>
</div>
        <small class="text-muted">
            üì± En celular se muestran Usuario y Puntos. Gir√° el tel√©fono para m√°s detalle.
        </small>
    </div>
</div>

{% endblock %}
