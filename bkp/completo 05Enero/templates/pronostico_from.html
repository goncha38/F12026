<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <title>Pronóstico - {{ carrera.pais }} {{ carrera.autodromo }}</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
<div class="container py-4">
  <h2>Pronóstico — {{ carrera.pais }} / {{ carrera.autodromo }}</h2>

  <p>Clasificación: <strong>{{ carrera.clasificacion if carrera.clasificacion else carrera.fecha }}</strong></p>
  <p>Tiempo restante: <strong>{{ tiempo_restante_clasificacion(carrera) }}</strong></p>

  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  {% if not abierto %}
    <div class="alert alert-warning">La carga de pronósticos está cerrada para esta carrera.</div>
  {% endif %}

  <form method="POST" {% if not abierto %}onsubmit="return false;"{% endif %}>
    <div class="mb-3">
      <label class="form-label">Poleman (qualy)</label>
      <select name="poleman" class="form-select" required {% if not abierto %}disabled{% endif %}>
        <option value="">-- seleccionar --</option>
        {% for p in pilotos %}
          <option value="{{ p.id }}" {% if existente and existente.poleman == p.id %}selected{% endif %}>{{ p.nombre }} ({{ p.equipo }})</option>
        {% endfor %}
      </select>
    </div>

    {% if carrera.sprint == 1 or carrera['sprint'] == 1 %}
    <div class="mb-3">
      <label class="form-label">Ganador Sprint</label>
      <select name="sprint_ganador" class="form-select" {% if not abierto %}disabled{% endif %}>
        <option value="">-- (opcional) --</option>
        {% for p in pilotos %}
          <option value="{{ p.id }}" {% if existente and existente.sprint_ganador == p.id %}selected{% endif %}>{{ p.nombre }}</option>
        {% endfor %}
      </select>
    </div>
    {% endif %}

    <div class="row">
      <div class="col-md-4 mb-3">
        <label class="form-label">1°</label>
        <select name="p1" class="form-select" required {% if not abierto %}disabled{% endif %}>
          <option value="">-- seleccionar --</option>
          {% for p in pilotos %}
            <option value="{{ p.id }}" {% if existente and existente.podio_1 == p.id %}selected{% endif %}>{{ p.nombre }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label">2°</label>
        <select name="p2" class="form-select" required {% if not abierto %}disabled{% endif %}>
          <option value="">-- seleccionar --</option>
          {% for p in pilotos %}
            <option value="{{ p.id }}" {% if existente and existente.podio_2 == p.id %}selected{% endif %}>{{ p.nombre }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-4 mb-3">
        <label class="form-label">3°</label>
        <select name="p3" class="form-select" required {% if not abierto %}disabled{% endif %}>
          <option value="">-- seleccionar --</option>
          {% for p in pilotos %}
            <option value="{{ p.id }}" {% if existente and existente.podio_3 == p.id %}selected{% endif %}>{{ p.nombre }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    {% if abierto %}
      <button class="btn btn-success">Guardar pronóstico</button>
    {% else %}
      <a class="btn btn-secondary" href="/mis_pronosticos">Volver</a>
    {% endif %}
  </form>

  <div class="mt-3">
    <a href="/mis_pronosticos" class="btn btn-link">Volver a Mis Pronósticos</a>
  </div>
</div>

<!-- Validación cliente simple para podio -->
<script>
document.addEventListener("DOMContentLoaded", function(){
  const form = document.querySelector("form");
  if(!form) return;
  form.addEventListener("submit", function(e){
    const p1 = form.querySelector("[name='p1']").value;
    const p2 = form.querySelector("[name='p2']").value;
    const p3 = form.querySelector("[name='p3']").value;
    if (p1 && p2 && p3 && (p1 === p2 || p1 === p3 || p2 === p3)) {
      e.preventDefault();
      alert("No podés repetir pilotos en el podio.");
      return false;
    }
  });
});
</script>
</body>
</html>
